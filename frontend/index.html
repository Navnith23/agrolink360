<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgroLink 360</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Login Page -->
  <div id="loginPage" class="login-container animate">
    <h2>🌿 AgroLink 360</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="👤 Username" required>
      <input type="password" id="password" placeholder="🔒 Password" required>
      <input type="text" id="fullname" placeholder="📛 Full Name" required>
      <input type="number" id="age" placeholder="🎂 Age" required>
      <p id="error" class="error"></p>
      <button type="submit">Login 🚀</button>
    </form>
  </div>

  <!-- Dashboard Page -->
  <div id="dashboardPage" class="dashboard" style="display: none;">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>🌿 AgroLink 360°</h2>
      <button onclick="showSection('chat')">💬 Chat</button>
      <button onclick="showSection('buy')">🛒 Buy</button>
      <button onclick="showSection('sell')">📦 Sell</button>
      <button onclick="showSection('weather')">☁ Live Weather</button>
      <button onclick="showSection('news')">📰 News</button>
    </div>

    <!-- Main content -->
    <div class="main">
      <div class="content-box">
        <h2 id="sectionTitle">Welcome to AgroLink 360</h2>
        <div id="sectionContent">
          <p>Select an option from the left menu.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("loginForm");
      if (form) {
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const password = document.getElementById("password").value;
          const error = document.getElementById("error");

          // Password validation: min 8 chars, 1 uppercase, 1 special char
          const regex = /^(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,}$/;
          if (!regex.test(password)) {
            error.textContent = "⚠ Password must be 8+ chars, 1 uppercase, 1 special char.";
            return;
          }

          error.textContent = "";
          // Show dashboard instead of redirect
          document.getElementById("loginPage").style.display = "none";
          document.getElementById("dashboardPage").style.display = "flex";

          // Load default dashboard section
          showSection("chat");
        });
      }
    });

    // Dashboard section switcher
    function showSection(section) {
      const title = document.getElementById("sectionTitle");
      const content = document.getElementById("sectionContent");

      if (section === "chat") {
        title.innerText = "Chat Room";
        content.innerHTML = `
          <div class="chat-container">
            <div class="chat-header">
              👤 Farmer Chat
              <div class="profile-circle">F</div>
            </div>
            <div class="chat-messages" id="chatMessages">
              <p><b>You:</b> Hello!</p>
            </div>
            <div class="chat-input">
              <input type="text" id="chatInput" placeholder="Type a message...">
              <button id="sendBtn">Send</button>
              <button id="voiceBtn">🎤</button>
            </div>
          </div>
        `;

        const input = document.getElementById("chatInput");
        const btn = document.getElementById("sendBtn");

        // Send message on Enter
        input.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });

        // Send button
        btn.addEventListener("click", sendMessage);

        // Voice button placeholder
        document.getElementById("voiceBtn").addEventListener("click", () => {
          alert("🎤 Voice message feature coming soon!");
        });

      } else if (section === "buy") {
        title.innerText = "Buy Products";
        content.innerHTML = "<p>🛒 Browse and buy spices, seeds, and tools here.</p>";
        // TODO: fetch products from backend
      } else if (section === "sell") {
        title.innerText = "Sell Products";
        content.innerHTML = "<p>📦 List your farm produce here for selling.</p>";
        // TODO: implement sell product functionality
      } else if (section === "weather") {
        title.innerText = "Live Weather";
        content.innerHTML = "<p>☁ Weather updates will appear here.</p>";
        // TODO: fetch live weather
      } else if (section === "news") {
        title.innerText = "Agri News";
        content.innerHTML = "<p>📰 Latest agricultural news will appear here.</p>";
        // TODO: fetch news
      } else {
        title.innerText = "Welcome to AgroLink 360";
        content.innerHTML = "<p>Select an option from the left menu.</p>";
      }
    }

    // Chat send message with timestamp
    function sendMessage() {
      const input = document.getElementById("chatInput");
      const messages = document.getElementById("chatMessages");

      if (input && input.value.trim() !== "") {
        const now = new Date();
        const time = now.getHours().toString().padStart(2,'0') + ':' +
                     now.getMinutes().toString().padStart(2,'0') +
                     ' ' + now.getDate() + '/' + (now.getMonth()+1) + '/' + now.getFullYear();

        const msg = document.createElement("p");
        msg.innerHTML = `<b>You:</b> ${input.value} <span style="font-size:0.7em;color:gray;">${time}</span>`;
        messages.appendChild(msg);
        input.value = "";
        messages.scrollTop = messages.scrollHeight;
      }
    }
  </script>
</body>
</html>
